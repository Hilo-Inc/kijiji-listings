
import React, { Component } from 'react';
import ReactDOM from 'react-dom';
import axios from 'axios';
import arrangeListings from './arrangeListings';
import randomColor from 'randomcolor';
import './App.css';

class App extends Component {

  constructor(props) {
    super(props);

    this.state = {
      listings: []
    };

    this.getListings("data/listings.json");
  }

  getListings(url) {
    axios.get(url)
      .then(response => {
        this.setState({ listings: this.sortListings(response.data) });
      })
      .catch(error => {
        console.log(error);
      });
  }

  sortListings(data){
    return data.sort(function(a,b) { 
      return ((b.w * b.h) - (a.w * a.h)); 
    });
  }

  render() {
    return (
      <div className="App">
        <Header />
        <Listings listings={this.state.listings}/>
      </div>
    );
  }
}

const IconKijijiLogo = React.createClass({
 render() {
   return (
    <svg xmlns="http://www.w3.org/2000/svg" width={this.props.width} height={this.props.height} viewBox="0 0 612 301.7" id="kijiji-logo">
        <title id={this.props.iconTitle}>Kijiji</title>
        <path fill="#F90" d="M192.8 88.3c14.9 0 26.9-12.1 26.9-27s-12-26.9-26.9-26.9c-14.9 0-26.9 12.1-26.9 26.9-.1 14.9 12 27 26.9 27m-13.6-27c0-7.3 5.9-13.2 13.2-13.2 7.3 0 13.2 5.9 13.2 13.2 0 7.3-5.9 13.2-13.2 13.2-7.4-.1-13.2-6-13.2-13.2"></path>
        <path fill="#F30" d="M281.7 53.9c14.9 0 26.9-12.1 26.9-27S296.6 0 281.7 0c-14.9 0-27 12.1-27 27s12.1 26.9 27 26.9m-13-26.9c0-7.3 5.9-13.1 13.2-13.1 7.3 0 13.1 5.9 13.1 13.1 0 7.3-5.9 13.2-13.1 13.2-7.3 0-13.2-5.9-13.2-13.2"></path>
        <path fill="#66C" d="M370.7 98.7c14.9 0 27-12.1 27-26.9 0-14.9-12.1-27-27-27s-26.9 12.1-26.9 27c-.1 14.9 12 26.9 26.9 26.9m-12.9-26.4c0-7.3 5.8-13.2 13.1-13.2s13.2 5.9 13.2 13.2c0 7.3-5.9 13.2-13.2 13.2-7.3 0-13.1-5.9-13.1-13.2"></path>
        <path fill="#9C3" d="M459.6 68c14.9 0 27-12 27-27 0-14.9-12.1-26.9-27-26.9S432.7 26.2 432.7 41c0 15 12.1 27 26.9 27m-12.9-27.5c0-7.3 5.9-13.2 13.2-13.2 7.3 0 13.1 5.9 13.1 13.2 0 7.3-5.9 13.1-13.1 13.1-7.3 0-13.2-5.9-13.2-13.1"></path>
        <path fill="#909" d="M548.6 81.8c14.9 0 26.9-12.1 26.9-27s-12.1-26.9-26.9-26.9c-14.9 0-26.9 12.1-26.9 26.9 0 14.9 12 27 26.9 27m-12.9-27c0-7.3 5.9-13.2 13.1-13.2 7.3 0 13.2 5.9 13.2 13.2 0 7.3-5.9 13.2-13.2 13.2-7.2 0-13.1-5.9-13.1-13.2"></path>
        <path fill="#FFF" d="M583.1 223.5c-16.9-.9-18.3-2-18.6-7.8-.3-7.2-.8-16.8-.8-36.9v-40.1c0-13.8.2-23.2.5-31.9.2-3.1 1.5-4.4 18.4-8.5l1.2-.3-.9-11-3.6.9c-2.8.6-12.7 2.7-25 4.7-4.8.9-14.7 2.2-15 2.2-12.3 1.4-22.5 2-25.3 2.1l-1 .1-.7 11h1.2c17.5-.6 19.8.1 20 3.2.6 5.1.8 14.2.8 31.5v31.2c0 20.3-.8 35-1.2 42-.2 4.8-1.1 6.9-20.8 7.7h-1l-.4 11.3 14.4-.4c5.9-.3 12.6-.6 21.4-.6 8.3 0 15.5.3 21.8.6l15.1.4v-1l.5-10.3-1-.1zm-177.5 18.7c-16.9-.9-18.3-2-18.6-7.8-.4-7.2-.8-16.9-.8-36.9v-40.1c0-13.8.2-23.8.5-32.5l.1-1.5c.2-3.1 1.5-4.4 18.4-8.5l1.2-.3-.9-11.1-3.6.9c-2.8.6-12.7 2.8-25 4.7-4.8.8-14.8 2.2-15 2.2-12.3 1.4-22.5 2-25.3 2.1l-12 .5-.8 11 12.2-.5c17.5-.6 19.8.1 20 3.3.5 5.1.9 16.4.9 33.7v31.2c0 20.3-.8 35-1.3 42-.2 4.8-1.1 7-20.8 7.7l-1 .1-.4 11.3 14.4-.5c5.9-.3 12.7-.6 21.4-.6 8.3 0 15.5.3 21.9.6l15.1.4v-1l.5-10.2-1.1-.2zm-196-26.6c-.4-7.2-.8-16.8-.8-36.9V145c0-13.8.2-22 .5-30.7l.1-1.2c.2-3.1 1.5-4.4 18.4-8.5l8.4-2-1-11-10.9 2.6c-2.7.6-12.7 2.8-25 4.7-4.8.8-14.7 2.2-15 2.2-12.3 1.4-22.5 2-25.3 2.1l-4 .2-.7 11 4.3-.2c17.5-.6 19.8.1 20 3.2.5 5.1.8 14.2.8 31.5v24.7c0 20.3-.8 35-1.3 42-.2 4.6-1.1 6.8-19 7.6h-2.4c-7.2.1-10.8-1.2-14.4-5.1-9.1-10.2-40.7-52.3-56.4-76 12.1-10.6 29.2-36.2 36.7-42.5 7.4-6.5 12.4-9.7 28.9-12.9l1-.2-1.1-10.9-10.9 1.6-20.4 2.9c-12.5 1.6-23.7 2.8-33.2 3.7l-1 .1.6 10.7 15.4-.1c1.2 0 1.6.3 1.7.4v.1c0 .3-.1.9-1.1 2.4-7 8.9-32.9 46.6-50.4 50.5v-68c0-24.8.8-49 1.3-65l.1-3.7-1.3.2c-10.3 1.8-29.2 3.7-48.3 4H2.8v10.9l12.9.3c5.8 0 6.3 1.4 6.4 3.2.4 9.8.6 25.4.5 49.2v87.1c0 25.7-1.2 45.3-1.6 50.7-.3 4.4-1.3 6.8-19.7 7.4h-1L0 235.6l11.2-.4c5.6-.3 12.7-.7 23-.7 8 0 14.6.3 21 .6l17 .5.1-1 .8-10.3H72c-18.2-.8-18.9-2-19.2-7.4-.6-12.4-.7-27-.7-42.5V158c6.4-1.4 10.7-.3 13.8 3.9 6.6 9 39.4 57.7 51.3 77.6l.4.7.8-.2c5.7-1.2 13.3-2.4 21.3-3.2 6.9-.9 15-1.6 22.8-2l8.1-.3c5.9-.3 12.7-.6 21.4-.6 8.3 0 15.5.3 21.9.6l15.1.5v-1l.5-10.2-1.1-.1c-17.1-1.2-18.5-2.3-18.8-8.1"></path>
        <path fill="#FFF" d="M496.7 82.2c-6.3 0-22.6-1-22.6-1l-6.7-.4-17.8-1.2c-10.6-.9-20-1.8-26.6-2.6l-11-1.4-.7 11.1 26.3 3.9c5.2.8 5.2 2 5.5 4.7.8 10 1.1 30.3 1.1 61.9 0 40.7-.8 69.7-2.6 91.2-1.5 19.8-7.4 32-17.8 36.2-1.9-3.9-5.9-6.7-10.6-6.7-6.5 0-11.8 5.3-11.8 11.8 0 4 2 7.6 5 9.7l1.2.8c.5.3 1.1.5 1.7.7.2.1 1.2.4 1.4.4.8.2 1.6.2 2.4.2.5 0 .9 0 1.4-.1 9.2-.7 26.6-7.8 39.8-22.8 9.6-10.9 15.4-25.9 17.3-44.4 1.5-13.2 1.8-28.8 1.8-54.7l.3-78.7s0-1.3.1-3.5c.2-2.2.8-3.8 6.1-3.9h16.8l1.2-11.2h-1.2zM320.1 61.5c-6.2 1-22.5 2.7-22.5 2.7l-6.6.8-17.8 1.8c-10.5.9-20 1.6-26.6 1.8l-11 .5 1.2 11 26.5-.6c5.3 0 5.9 1.4 6.2 3.7 0 0 0 .5.1 2.7.5 11.2.8 29.7.8 56 0 40.7-.8 62.5-2.6 83.9-1.5 19.9-7.5 32-17.9 36.3-1.9-4-6-6.8-10.7-6.8-6.5 0-11.8 5.3-11.8 11.8 0 4.6 2.7 8.7 6.6 10.6.4.2 1.9.7 2.1.8.3.1.7.2 1.1.3.6.1 2.1.2 2.2.2 8.7 0 27.3-7.1 41.2-22.9 9.6-10.9 15.4-25.9 17.3-44.4 1.5-13.2 1.8-21.6 1.8-47.5l.3-78.7s.1-3.1.1-5.3c0-2.3.3-4.1 5.5-5.1l23.5-3.7-.7-11.3-8.3 1.4zm273.2 23.8h7.4v1.5H598v7.7h-2v-7.7h-2.7m14.3 7.7h-1.7l-2.4-7.9v7.9h-1.9v-9.2h3.3l1.9 6.7 2.1-6.7h3.1v9.2h-1.8v-7.8l-.1-.1"></path>
    </svg>
   )
 }
});

class Header extends Component {
  render() {
    return (
        <div className="App-header">
          <IconKijijiLogo iconTitle="Kijiji" width="100%" height="100%"/>
        </div>
    );
  }
}

class Listings extends Component {

  render() {
    return (
        <div className="App-listings">
          <ListingsItem listings={this.props.listings} />
        </div>
    );
  }
}


class ListingsItem extends Component {

  componentWillMount() {
    this.arrangeListings = new arrangeListings();
  }

  render() {   
    
    this.arrangeListings.init(this.props.listings, 800, 800);

    const listings = this.props.listings.map((listing, index) => {

      this.bgColor = randomColor();

      if (listing.fit){

        this.divStyle = {
          top: listing.fit.y, 
          left: listing.fit.x, 
          width: listing.w, 
          height: listing.h, 
          backgroundColor: this.bgColor
          //backgroundImage: 'url(' + listing.image + ')'
        };

        return (
          <div key={index} className="App-listings-item" style={this.divStyle}>
            <p style={{fontSize: '100%'}}>{listing.title}</p>
          </div>
        );

      }

    });

    return (
        <div>{listings}</div>
    );

  }
}

export default App;
